title: SHtml.idMemoize -- Simple Ajax Updating
date: 2011/02/23 15:45:54 -0800
tags: []
author: David Pollak
alias: /shtmlidmemoize-simple-ajax-updating

Lift 2.3 has a new feature: SHtml.idMemoize.  Basically, it lets you use Lift CSS Selector Transforms yet capture the template that was run through the transform such that the you can re-render the HTML in a given Element without having to explicitly load the template that was used to render the page.<p /> Let&#39;s take a look at an example, let&#39;s say you have some HTML:<p /><span style="font-family: courier new,monospace;">      &lt;div class=&quot;lift:ShowMemoize&quot;&gt;</span><br style="font-family: courier new,monospace;" /> <span style="font-family: courier new,monospace;">        &lt;button name=&quot;refresh_all&quot;&gt;Refresh All&lt;/button&gt;</span><p /> <span style="font-family: courier new,monospace;">        &lt;div name=&quot;one&quot;&gt;</span><br style="font-family: courier new,monospace;" /><span style="font-family: courier new,monospace;">          &lt;span&gt;The current time is: &lt;/span&gt;</span><br style="font-family: courier new,monospace;" /> <span style="font-family: courier new,monospace;">          &lt;button&gt;Click Me&lt;/button&gt;</span><br style="font-family: courier new,monospace;" /><span style="font-family: courier new,monospace;">        &lt;/div&gt;</span><p /> <span style="font-family: courier new,monospace;">        &lt;div name=&quot;two&quot;&gt;        </span><br style="font-family: courier new,monospace;" /><span style="font-family: courier new,monospace;">          &lt;button&gt;Update this&lt;/button&gt;</span><br style="font-family: courier new,monospace;" /> <span style="font-family: courier new,monospace;">          &lt;ul&gt;</span><br style="font-family: courier new,monospace;" /><span style="font-family: courier new,monospace;">            &lt;li&gt;Count: &lt;/li&gt;</span><br style="font-family: courier new,monospace;" /> <span style="font-family: courier new,monospace;">          &lt;/ul&gt;</span><br style="font-family: courier new,monospace;" /><span style="font-family: courier new,monospace;">        &lt;/div&gt;</span><br style="font-family: courier new,monospace;" /> <span style="font-family: courier new,monospace;">      &lt;/div&gt;</span><p />Basically, a &lt;div&gt; that contains two sub-&lt;div&gt;s.  We want to be able to click on the buttons and have either or both of the &lt;div&gt;s updated (depending on which button we press).  Let&#39;s look at the Lift snippet that allows you to redraw part or all of the above HTML:<p /> <span style="font-family: courier new,monospace;">object ShowMemoize {<br />  def render =<br />    &quot;div&quot; #&gt; SHtml.idMemoize(<br />      outer =&gt; <br />      // redraw the whole div when this button is pressed<br />       &quot;@refresh_all [onclick]&quot; #&gt; SHtml.ajaxInvoke(outer.setHtml _) &amp;<p />      // deal with the &quot;one&quot; div<br />      &quot;@one&quot; #&gt; SHtml.idMemoize(<br />        one =&gt; <br />          &quot;span *+&quot; #&gt; now.toString &amp; // display the time<br />         &quot;button [onclick]&quot; #&gt; SHtml.ajaxInvoke(one.setHtml _)) &amp; // redraw <p />      // deal with the &quot;two&quot; div<br />      &quot;@two&quot; #&gt; SHtml.idMemoize(<br />        two =&gt; // the &quot;two&quot; div<br />           // display a bunch of items<br />          &quot;ul *&quot; #&gt; (0 to randomInt(6)).map(i =&gt; &quot;li *+&quot; #&gt; i) &amp;<br />        // update the &quot;two&quot; div on button press<br />        &quot;button [onclick]&quot; #&gt; SHtml.ajaxInvoke(two.setHtml _)))<br /> }<br /></span><br />This code does the following:<br /><ul><li>Selects the outer &lt;div&gt;</li><li><span style="font-family: courier new,monospace;">SHtml.idMemoize</span> is a method that takes <span style="font-family: courier new,monospace;">IdMemoizeTransform =&gt; NodeSeqFuncOrSeqNodeSeqFunc</span> as a parameter.  That type signature may look weird, so let&#39;s break it down:</li> <ul><li>It&#39;s a function that takes an <span style="font-family: courier new,monospace;">IdMemoizeTransform</span> as an input and</li><li>returns a <span style="font-family: courier new,monospace;">NodeSeqFuncOrSeqNodeSeqFunc</span>.  &quot;What&#39;s a NodeSeqFuncOrSeqNodeSeqFunc?&quot; you ask.  It&#39;s a NodeSeq =&gt; NodeSeq or a Seq[NodeSeq =&gt; NodeSeq]... it&#39;s basically what you get with a CSS Selector Transform... and there&#39;s an implicit conversion from either NodeSeq =&gt; NodeSeq or Seq[NodeSeq =&gt; NodeSeq] to NodeSeqFuncOrSeqNodeSeqFunc.</li> <li>Basically, it&#39;s a function that takes the IdMemoizeTransform and returns a CSS Selector Transform</li></ul><li>We capture the outer variable which is the IdMemoizeTransform and the do our normal CSS Selector Transform with it</li> <li>We set the onclick attribute of the &lt;button&gt; with id refresh_all to an Ajax invocation of the outer.setHtml() method.  So, when the button is clicked, the body of the outer &lt;div&gt; will be redrawn based on the CSS Selector Transform and the template that was used in the transform.</li> <li>Each of the inner &lt;div&gt;s get the same treatment and each has a &lt;button&gt; that will redraw just that part of the screen</li></ul>So, the snippet does not have to explicitly know the template passed in... it will do the right thing no matter the template.  You can even have two invocations of the same snippet on the same page with different templates and SHtml.idMemoize will &quot;do the right thing&quot; with the templates.  This makes it easy to build Ajax applications that update the screen real estate the right way.<p /> You can see an example at <a href="https://github.com/dpp/starting_point/tree/idMemoize">https://github.com/dpp/starting_point/tree/idMemoize</a>
