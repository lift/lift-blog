title: Lift's CSS Selector Transforms
date: 2010/11/01 14:56:41 -0700
tags: []
author: David Pollak
alias: /lifts-css-selector-transforms

Lift 2.2-M1 introduced a new mechanism for transforming XHTML: CSS Selector Transforms (<span style="font-family: monospace;">CssBindFunc</span>).  The new mechanism provides a subset of CSS selectors that can be used to transform <span style="font-family: monospace;">NodeSeq =&gt; NodeSeq</span>.  Examples of this feature include:<br /> <ul> <li style="font-family: monospace;">&quot;#name&quot; #&gt; userName // replace the element with the id name with the variable userName</li> <li style="font-family: monospace;">&quot;#chat_lines *&quot; #&gt; listOfChats // replace the content of chat_lines with each element of listOfChats</li> <li style="font-family: monospace;">&quot;.pretty *&quot; #&gt; &lt;b&gt;Unicorn&lt;/b&gt; // each element with CSS class pretty, replace content with &lt;b&gt;Unicorn&lt;/b&gt;</li> <li style="font-family: monospace;">&quot;dog=cat [href]&quot; #&gt; &quot;<a href="http://dogscape.com">http://dogscape.com</a>&quot; // set the href attribute of all elements with the dog attribute set to cat</li> <li><span style="font-family: monospace;">&quot;#name&quot; #&gt; userName &amp; &quot;#age&quot; #&gt; userAge // set name to userName and age to userAge</span><br /> </li> </ul> CSS Selector Transforms extends <span style="font-family: monospace;">NodeSeq =&gt; NodeSeq</span>... they are quite literally functions and can be passes as a parameter to anything expecting <span style="font-family: monospace;">NodeSeq =&gt; NodeSeq</span> or returned as a result for any method that returns <span style="font-family: monospace;">NodeSeq =&gt; NodeSeq</span>.<p />  Let&#39;s look at each of the pieces to see how they work.<p />  First, you must import <span style="font-family: monospace;">net.liftweb.util._</span> and <span style="font-family: monospace;">import Helpers._</span>  These packages include the classes and the implicit conversions that make the CSS Selector tranforms work.<p />  The transform is defined by: String representing selector <span style="font-family: monospace;">#&gt;</span> transform value.<p />  The selector is a String constant which implements the following subset of CSS Selectors:<br /> <ul> <li><span style="font-family: monospace;">#id</span> -- selects the element with the specified id<br /> </li> <li><span style="font-family: monospace;">.class</span> -- selects all elements have a class attribute where one of the space-separated values equals class<br /> </li> <li><span style="font-family: monospace;">attr_name=attr_value</span> -- selects all elements where the given attribute equals the given value</li> </ul> You can replacement rules after the selector:<br /> <ul> <li>none (e.g., <span style="font-family: monospace;">&quot;#id&quot;</span>) replaces all matching elements with the values<br /> <span style="font-family: monospace;">&quot;#name&quot; #&gt; &quot;David&quot; // &lt;span&gt;&lt;span id=&quot;name&quot;/&gt;&lt;/span&gt; -&gt; &lt;span&gt;David&lt;/span&gt;</span><br /> </li> <li><span style="font-family: monospace;">*</span> (e.g., <span style="font-family: monospace;">&quot;#id *&quot;</span>) replaces the content children of the matching elements with the values<br /> <span style="font-family: monospace;">&quot;#name&quot; #&gt; &quot;David&quot; // &lt;span&gt;&lt;span id=&quot;name&quot;/&gt;&lt;/span&gt; -&gt; &lt;span&gt;&lt;span id=&quot;name&gt;David&lt;/span&gt;&lt;/span&gt;</span><br /> </li> <li><span style="font-family: monospace;">[attr]</span> (e.g., <span style="font-family: monospace;">&quot;#id [href]&quot;</span>) replaces the matching attribute&#39;s value with the values (note in the case of the <span style="font-family: monospace;">class</span> attribute, the values are appended to the element&#39;s <span style="font-family: monospace;">class</span> attributes).<br /> <span style="font-family: monospace;">&quot;#link [href]&quot; #&gt; &quot;<a href="http://dogscape.com">http://dogscape.com</a>&quot; // <a href="#">Dogscape</a> -&gt; <a href="http://dogscape.com">Dogscape</a></span></li> </ul> The right hand side of the CSS Selector Transform can be one of the following:<br /> <ul> <li><span style="font-family: monospace;">String</span> -- a String constant, for example:<br /> <span style="font-family: monospace;">&quot;#name *&quot; #&gt; &quot;David&quot; // &lt;span id=&quot;name&quot;/&gt; -&gt; &lt;span id=&quot;name&quot;&gt;David&lt;/span&gt;</span><br style="font-family: monospace;" /> <span style="font-family: monospace;">&quot;#name *&quot; #&gt; getUserNameAsString</span><br /> </li> <li><span style="font-family: monospace;">NodeSeq</span> -- a NodeSeq constant, for example:<br /> <span style="font-family: monospace;">&quot;#name *&quot; #&gt; &lt;i&gt;David&lt;/i&gt; // &lt;span id=&quot;name&quot;/&gt; -&gt; &lt;span id=&quot;name&quot;&gt;&lt;i&gt;David&lt;/i&gt;&lt;/span&gt;</span><br style="font-family: monospace;" /> <span style="font-family: monospace;">&quot;#name *&quot; #&gt; getUserNameAsHtml</span><br /> </li> <li><span style="font-family: monospace;">NodeSeq =&gt; NodeSeq</span> -- a function that transforms the node (yes, it can be a CssBindFunc):<br /> <span style="font-family: monospace;">&quot;#name&quot; #&gt; (n: NodeSeq) =&gt; n % (&quot;class&quot; -&gt; &quot;dog&quot;) // <span style="font-family: monospace;">&lt;span id=&quot;name&quot;/&gt; -&gt; &lt;span id=&quot;name&quot; class=&quot;dog&quot;/&gt;</span><br /> </span></li> <li><span style="font-family: monospace;">Bindable</span> -- something that implements the <span style="font-family: monospace;">Bindable</span> trait (e.g., <span style="font-family: monospace;">MappedField</span> and <span style="font-family: monospace;">Record.Field</span>)<br /> </li> <li><span style="font-family: monospace;">StringPromotable</span> -- A constant that can be promoted to a <span style="font-family: monospace;">String</span> (<span style="font-family: monospace;">Int, Symbol, Long </span>or<span style="font-family: monospace;"> Boolean</span>).  There is an automatic (implicit) conversion from <span style="font-family: monospace;">Int, Symbol, Long </span>or<span style="font-family: monospace;"> Boolean</span> to <span style="font-family: monospace;">StringPromotable</span>.<br /> <span style="font-family: monospace;">&quot;#id_like_cats&quot; #&gt; true</span><br style="font-family: monospace;" /> <span style="font-family: monospace;">&quot;#number_of_cats&quot; #&gt; 2</span><br /> </li> <li><span style="font-family: monospace;">IterableConst</span> -- A <span style="font-family: monospace;">Box</span>, <span style="font-family: monospace;">Seq</span>, or <span style="font-family: monospace;">Option</span> of <span style="font-family: monospace;">String</span>, <span style="font-family: monospace;">NodeSeq</span>, or <span style="font-family: monospace;">Bindable</span>.  Implicit conversions automatically promote the likes of <span style="font-family: monospace;">Box[String]</span>, <span style="font-family: monospace;">List[String]</span>, <span style="font-family: monospace;">List[NodeSeq]</span>, etc. to <span style="font-family: monospace;">IterableConst</span>.<br /> <span style="font-family: monospace;">&quot;#id&quot; #&gt; (Empty: Box[String]) // &lt;span&gt;&lt;span id=&quot;id&quot;&gt;Hi&lt;/span&gt;&lt;/span&gt; -&gt; &lt;span/&gt;</span><br style="font-family: monospace;" /> <span style="font-family: monospace;">&quot;#id&quot; #&gt; List(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;) // &lt;span&gt;&lt;span id=&quot;id&quot;/&gt;&lt;/span&gt; -&gt; &lt;span&gt;abc&lt;/span&gt;</span><br style="font-family: monospace;" /> <span style="font-family: monospace;">&quot;#id [href]&quot; #&gt; (None: Option[String]) &lt;a id=&quot;id&quot; href=&quot;dog&quot;/&gt; -&gt; &lt;a id=&quot;id&quot;/&gt;</span><p />  Note that if you bind to the children of a selected element, multiple copies of the element result from bind to an IterableConst (if the element has an id attribute, the id attribute will be stripped after the first element):<br /> <span style="font-family: monospace;">&quot;#line *&quot; #&gt; List(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;) // &lt;li id=&quot;line&gt;sample&lt;/li&gt; -&gt; &lt;li id=&quot;line&quot;&gt;a&lt;/li&gt;&lt;li&gt;b&lt;/li&gt;&lt;li&gt;c&lt;/li&gt;</span><br style="font-family: monospace;" /> <span style="font-family: monospace;">&quot;#age *&quot; #&gt; (None: Option[NodeSeq]) // &lt;span&gt;&lt;span id=&quot;age&quot;&gt;Dunno&lt;/span&gt;&lt;/span&gt; -&gt; &lt;span/&gt;</span><p />  The above use cases may seem a little strange (they are not quite orthogonal), but they address common use cases in Lift.<br /> </li> <li><span style="font-family: monospace;">IterableFunc</span> -- A <span style="font-family: monospace;">Box</span>, <span style="font-family: monospace;">Seq</span>, or <span style="font-family: monospace;">Option</span> of functions that transform <span style="font-family: monospace;">NodeSeq =&gt; String, NodeSeq, Seq[String], Seq[NodeSeq], Box[String], Box[NodeSeq], Option[String]</span> or <span style="font-family: monospace;">Option[NodeSeq]</span>.  The same rules for handling multiple values in <span style="font-family: monospace;">IterableConst</span> apply to <span style="font-family: monospace;">IterableFunc</span>.  Implicit conversions automatically promote the functions with the appropriate signature to an <span style="font-family: monospace;">IterableFunc</span>.<br /> </li> </ul> You can chain CSS Selector Transforms with the <span style="font-family: monospace;">&amp;</span> method:<br /> <span style="font-family: monospace;">&quot;#id&quot; #&gt; &quot;33&quot; &amp; &quot;#name&quot; #&gt; &quot;David&quot; &amp; &quot;#chat_line&quot; #&gt; List(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;) &amp; ClearClearable</span><p />  CSS Selector Transforms offer an alternative to Lift&#39;s traditional binding (See Helpers.bind()).
